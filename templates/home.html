{% extends "layout.html" %}
{% block content %}
    <script>
      let countdownElement = null;
      let deadline = null;
    </script>
    {% for task in tasks %}
    <!--{% if task.user_id == current_user.id %} -->
        <article class="media content-section">
          <div class="media-body">
            <div class="article-metadata">
              <a class="mr-2" href="/task/{{ task.id }}"> Szczegóły </a>
              <small class="text-muted">{{ task.deadline }}</small>
              <small id="countdown-{{ task.id }}" class="timer text-muted"> </small>
            </div>
            <h2><a class="article-title" href="#">{{ task.title }}</a></h2>
            <p class="article-content">{{ task.description }}</p>
          </div>
        </article>

      <script>
        //console.log("{{ current_user }}");
        // Twój istniejący kod z datą deadline'u
        //let task_js = {
        //  date: "{{ task.deadline }}"
        //};
        
        // Znajdź element licznika
        countdownElement = document.getElementById('countdown-{{ task.id }}')
        //console.log("task_js");  
        // Określ deadline na podstawie daty z Twojego kodu
        deadline = new Date("{{ task.deadline }}");
        //let deadline = task.deadline
        // Funkcja do aktualizacji licznika
        function updateCountdown() {
          // Oblicz pozostały czas do deadline'u
          let now = new Date();
          let difference = deadline - now;
    
          // Oblicz dni, godziny, minuty i sekundy
          let days = Math.floor(difference / (1000 * 60 * 60 * 24));
          let hours = Math.floor((difference % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
          let minutes = Math.floor((difference % (1000 * 60 * 60)) / (1000 * 60));
          let seconds = Math.floor((difference % (1000 * 60)) / 1000);
    
          // Aktualizuj tekst w elemencie licznika
          countdownElement.textContent = `Pozostało: ${days} dni, ${hours} godzin, ${minutes} minut, ${seconds} sekund`;
    
          // Sprawdź, czy deadline minął
          if (difference < 0) {
            countdownElement.textContent = 'Deadline minął';
            // Jeśli chcesz zatrzymać licznik po osiągnięciu deadline'u, możesz użyć clearInterval() tutaj
          }
        }
    
        // Wywołaj funkcję updateCountdown na początku
        updateCountdown();
    
        // Wywołaj funkcję updateCountdown co sekundę
        setInterval(updateCountdown, 1000);
      </script>
   <!-- {% endif %} -->
    {% endfor %}
{% endblock content %}